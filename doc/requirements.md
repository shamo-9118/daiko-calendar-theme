# 商品別数量スライド単価表示・制御システム 要件定義書

## 1. プロジェクト概要
名入れカレンダー等のB2B向け商品において、注文数量に応じた段階的価格（ボリュームディスカウント）を商品ページ上でリアルタイムに算出し、商習慣に合わせた不規則な数量単位での発注を可能にする、Shopifyを用いてECサイトを作成する。

## 2. 機能要件

### 2.1 数量選択（プルダウン方式）
- **制約付き選択**: 自由入力（input）を廃止し、プルダウン（select）形式を採用。
- **不規則なステップ数への対応**: 
  - 50,60,70,80,90,100,150,200,250,300,350,400,500,600,700,800,900,1000
- **メリット**: 生産・発注ロットに合わせた受注制限をユーザーに直感的に提示。

### 2.2 リアルタイムお見積り概算
- **動的計算**: 数量変更と同時にJavaScriptが発動し、以下の4項目を更新表示する。
  - **小計**: 適用単価（税抜） × 選択数量
  - **消費税**: 小計の10%
  - **合計金額**: 小計 + 消費税
  - **1冊あたりの税込単価**: 合計 ÷ 数量（参考値）
- **配置**: カート投入ボタンの直近に配置し、購入決定を支援する狙い。

### 2.3 データ構造（メタフィールド）
- **単価マスタ**: 商品ごとに異なる割引率を保持。
  - **Namespace**: `custom`
  - **Key**: `tier_prices`
  - **Type**: `json`
  - **Data Structure**:
    ```json
    [
      {"min_qty": 1, "unit_price": 1494},
      {"min_qty": 50, "unit_price": 915},
      {"min_qty": 100, "unit_price": 702}
    ]
    ```

## 3. 非機能要件

## 4. 実装コードの構成
1. **Liquid**: `main-product.liquid` 内にプルダウンと表示枠を記述。
2. **JSON**: 商品管理画面のメタフィールドに入力。
3. **JavaScript**: 数量変更イベントを検知し、JSONデータから該当単価を抽出して計算。

## 5. 今後の拡張（フェーズ2）
- **Shopify Functionsの実装**: 現在はフロントエンドの「表示」のみ。カート内価格の「自動書き換え」をバックエンドで実装する。
- **配送・校正オプション**: 名入れ情報のアップロードや校正有無の選択機能の追加。